 
<style type="text/css">
.male-span3{width:220px;height:108px;margin-left:0px;margin-top:2px;
}
.span1{background:lightblue;
                width:100px;margin-left:5px;border-radius:10px 0px;}
.bordered {
    border: 1px solid #CCCCCC;
    border-radius: 10px 10px 10px 10px;
    -moz-border-radius: 10px 10px 10px 10px;
    -webkit-border-radius: 10px 10px 10px 10px;
    box-shadow: 0 1px 1px #CCCCCC;
}
.img-polaroid{height:40px;width:60px;border-radius:10px}
.spouse-span1{background:lightpink;border-radius:10px 0px;
                  width:100px;margin-left:10px;}
.close{margin-top:0px;position:absolute;padding-left:10px;}
.single-span1{background:lightgreen;
                      border-radius:10px 0px;width:100px;margin-left:5px;margin-right:5px;}
table {
    border-spacing: 0;
    margin: 30px;
} 
.bordered th {
    background-color: #DCE9F9;
    background-image: -moz-linear-gradient(center top , #F8F8F8, #ECECEC);
    background-image: -webkit-gradient(linear, 0 0, 0 bottom, from(#F8F8F8), to(#ECECEC), color-stop(.4, #F8F8F8));
    border-top: medium none;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8) inset;
    text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
}

.bordered th {
    border-left: 1px solid #CCCCCC;
    border-top: 1px solid #CCCCCC;
    border-bottom: 2px solid #CCCCCC;
    padding: 10px;
    text-align: left;
}
.font{font-size: 16px;position: relative;padding: 4px;}

</style>
<% if @user.id == current_user.id %>
<div>
  <a class="btn btn-danger" href="/users/edit_profile/<%= current_user.id %>">Profile</a>
  <a class="btn btn-danger" href="/family_members/family/<%= current_user.id %>">Family Tree</a>
  <a class="btn btn-danger" href="/feedbacks/new/<%= current_user.id %>">Give feedback</a>
</div>
<% end %>
<br/>
<div id="treeDiv">
<% if @user.id == current_user.id %>
<form action="/family_members/join_pending/<%= current_user.id %>" method="post">
<% @all_users = User.all(:order => 'firstname') %>
<h2><font style="font-family: arial;" color="#890000">Build your Family Tree</font></h2>
<font style="font-family: arial; font-size:14pt;" color="#890000">MJ Id</font>
 <input type="text" size=3; name="search_mjid" />&nbsp;&nbsp;
<font style="font-family: arial; font-size:14pt;" color="#890000">Relation</font>
<select name="relation" class="select_style">
  <option value="0">Select</option>
  <% @all_relations.each do |relation| %>
    <option value="<%= relation.id %>"><%= relation.relationship %></option>
  <% end %>
</select> &nbsp;&nbsp;
<input type="submit" value="Add member" class="btn btn-success" style="position:absolute;" />
<label class="notice"><%= notice %></label>
</form>
<br/>
<hr/>
<!-- <a href = "/family_members/member_request_notifications/<%= current_user.id %>">Notifications</a><br/><br/> -->
<!-- <a href = "/family_members/copy_relations/<%= current_user.id %>">Push</a> -->
<% end %>
<h2><font style="font-family: arial;" color="#890000"><%= @user.firstname.capitalize %> <%= @user.lastname.capitalize %>'s Family</font></h2>
<center>
<div class="MainProfile">
<table >
  <tr>
    <td rowspan="7">
        <% if @user.photo_file_name.nil? %>
          <img src="/assets/empty_profile.jpeg" width="150" alt="" class="img-polaroid"/>
        <% else %>
           <%= image_tag @user.photo.url(:medium) ,:class =>'img-polaroid' %>
        <% end %>
    </td>
  </tr>
  <tr><td class="font">Name</td><td class="font">: &nbsp;<%= @user.firstname.capitalize %> <%= @user.lastname.capitalize %></td></tr>
  <tr><td class="font">Email</td><td class="font">: &nbsp;<%= @user.email %></td></tr>
  <tr><td class="font">Mobile</td><td class="font">: &nbsp;<%= @user.mobileno %></td></tr>
  <tr><td class="font">Gender</td><td class="font">: &nbsp;<%= @user.gender %></td></tr>
  <tr><td class="font">Occupation</td><td class="font">: &nbsp;<%= @user.occupation.capitalize %></td></tr>
  <tr><td class="font">City</td><td class="font">: &nbsp;<%= @user.station.capitalize %></td></tr>
  <tr><td></td><td class="font">Address</td><td class="font">: &nbsp;<%= @user.address %></td></tr>
</table>     
</div>
<br/><br/>

<% displayed_members_list = Array.new %>

<table class="bordered"  style = "width:100px;">
  <tr><th colspan=6>
        <h1><font style="font-family: arial;" color="#890000">First Generation</font></h1>
      </th>
  </tr>
  <tr>
      <% @user.relations.group("relationship").having("priority = ?", 1).order('id').each do |r| %>
          <td>
            <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
              <%= render 'family_member', :f => f , :displayed_members_list => displayed_members_list %>
            <% end %>
          </td>
      <% end %>
  </tr>
</table>

<table class="bordered" style = "width:100px;">
  <tr><th colspan=10>
        <h1><font style="font-family: arial;" color="#890000">Second Generation</font></h1>
      </th>
  </tr>
      <% @user.relations.group("relationship").having("priority = ?", 2).order('id').each do |r| %>
          <td>
            <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
              <%= render 'family_member', :f => f , :displayed_members_list => displayed_members_list %>
            <% end %>
          </td>
      <% end %>
  </tr>
</table>

<table class="bordered">
  <tr><th colspan=10>
        <h1><font style="font-family: arial;" color="#890000">Third Generation</font></h1>
      </th>
  </tr>
      <td>
      <div class="male-span3">
          <div class="single-span1" >
              <% if @user.photo_file_name.nil? %>
                <img src="/assets/empty_profile.jpeg" class="img-polaroid" alt="" style="" />
              <% else %>
                <%= image_tag @user.photo.url(:small), :class => 'img-polaroid'%>
              <% end %>
              &nbsp;<font size="3"><strong>Myself</strong></font><br>
              &nbsp;<%= @user.firstname.capitalize %><br/>
              &nbsp;<%= @user.station%>
          </div>
      </div>
      </td>
      <% displayed_members_list << current_user.id %>
      <% @user.relations.group("relationship").having("priority = ?", 3).order('id').each do |r| %>
          <td>
              <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
                <%= render 'family_member', :f => f , :displayed_members_list => displayed_members_list %>
              <% end %>
          </td>
      <% end %>
  </tr>
</table>

<table class="bordered">
  <tr><th colspan=10>
        <h1><font style="font-family: arial;" color="#890000">Fourth Generation</font></h1>
      </th>
  </tr>
      <% @user.relations.group("relationship").having("priority = ?", 4).order('id').each do |r| %>
          <td>
            <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
              <%= render 'family_member', :f => f , :displayed_members_list => displayed_members_list %>
            <% end %>
          </td>
      <% end %>
  </tr>
</table>

<table class="bordered">
  <tr><th colspan=10>
        <h1><font style="font-family: arial;" color="#890000">Fifth Generation</font></h1>
      </th>
  </tr>
      <% @user.relations.group("relationship").having("priority = ?", 5).order('id').each do |r| %>
          <td>
            <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
              <%= render 'family_member', :f => f , :displayed_members_list => displayed_members_list %>
            <% end %>
          </td>
      <% end %>
  </tr>
</table>
 