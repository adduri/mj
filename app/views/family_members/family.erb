
<!--<style type="text/css">
#topContact{display: none;}
</style>-->
<div>
<a class="btn btn-danger" href="/users/edit_profile/<%= current_user.id %>">Profile</a>
<a class="btn btn-danger" href="/family_members/family/<%= current_user.id %>">Family Tree</a>
<a class="btn btn-danger" href="/give_feedback">Give feedback</a>
</div>
<!-- | <a href="" onclick="window.print()">Print</a> -->
<br/>
<div id="treeDiv">
<form action="/family_members/add_family/<%= current_user.id %>" method="post">
<% @all_users = User.all(:order => 'firstname') %>
<h2>Build your Family Tree</h2>
MJ Id <input type="text" size=3; name="search_mjid" />&nbsp;&nbsp;
Relation
<select name="relation" class="select_style">
  <option value="0">Select</option>
  <% @all_relations.each do |relation| %>
    <option value="<%= relation.id %>"><%= relation.relationship %></option>
  <% end %>
</select> &nbsp;&nbsp;
<input type="submit" value="Add member" class="btn btn-success" style="position:absolute;" />
<label class="notice"><%= notice %></label>
</form><br/>
<hr/>

<% @family_members.each do |r| %>
would you like to join as <%= r.user.firstname  %> his/her <%= r.relationship %> ?
<a href="/family_members/join_pending/<%= r.id %>">Accept</a><br/> | <a href="/family_members/join_decline/<%= r.id %>">Decline</a>
<% end %>
<h2><%= @user.firstname %> <%= @user.lastname %>'s Family</h2>
<center>
<div class="MainProfile">
  <br/>
<table >
  <tr>
    <td rowspan="7">
          <% if @user.photo_file_name.nil? %>
            <img src="/assets/empty_profile.jpeg" width="150" alt="" class="img-polaroid"/>
          <% else %>
             <%= image_tag @user.photo.url(:medium) ,:class =>'img-polaroid' %>
          <% end %>
    </td>
  </tr>
  <tr><td class="font">Name</td><td class="font">: &nbsp;<%= @user.firstname %> <%= @user.lastname %></td></tr>
  <tr><td class="font">Email</td><td class="font">: &nbsp;<%= @user.email %></td></tr>
  <tr><td class="font">Mobile</td><td class="font">: &nbsp;<%= @user.mobileno %></td></tr>
  <tr><td class="font">Gender</td><td class="font">: &nbsp;<%= @user.gender %></td></tr>
  <tr><td class="font">Occupation</td><td class="font">: &nbsp;<%= @user.occupation %></td></tr>
  <tr><td class="font">Station</td><td class="font">: &nbsp;<%= @user.station %></td></tr>
  <tr><td></td><td class="font">Address</td><td class="font">: &nbsp;<%= @user.address %></td></tr>
</table>     
</div>
<br/><br/>


<table class="bordered">
  <tr><th colspan=10><font color="#800080 "><h1>First Generation</h1></font></th></tr>
  <tr>
    <% @user.relations.group("relationship").having("priority = ?", 1).order('id').each do |r| %>
    <td>
      <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
         <% family_member_user = User.find(f.family_member_user_id) %>
           
         <% if family_member_user.gender == "Male" %>
            <div class="span3"> 
              <div class="span1">
                      <% if family_member_user.photo_file_name.nil? %>
                        <img src="/assets/empty_profile.jpeg" class="img-polaroid" alt="" style="" />
                      <% else %>
                        <%= image_tag family_member_user.photo.url(:small), :class => 'img-polaroid'%>
                      <% end %>
                    <a href="/family_members/delete_member/<%= f.id %>" class="close">
                      <img src="/assets/close.png"/></a><br>
                      &nbsp;<font size="3"><strong><%= f.relation.relationship %></strong></font><br>
                      <a href="/family_members/family/<%= family_member_user.id %>">
                      &nbsp;<%= family_member_user.firstname %></a> <br>
                      &nbsp;<%= family_member_user.station%>
              </div>     
              <div class="spouse-span1">
                  <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                    <% unless f_m_spouse.nil? or f_m_spouse.blank? %>
                      <% spouse = User.find(f_m_spouse.family_member_user_id) %>
                      <% relation_with_spouse = FamilyMember.find_by_user_id_and_family_member_user_id(current_user.id,spouse.id) %>
                    
                       <% unless relation_with_spouse.nil? %> 
                        <% if spouse.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid"/>
                        <% else %>
                          <%= image_tag spouse.photo.url(:small) ,:class => 'img-polaroid' %>
                        <% end %>
                        <a href="/family_members/delete_member/<%= relation_with_spouse.id %>" class="close">
                         <img src="/assets/close.png"/></a><br>
                         &nbsp;<font size="3"><strong><%= relation_with_spouse.relation.relationship %></strong></font> <br>              
                      <a href="/family_members/family/<%= spouse.id %>">
                        &nbsp;<%= spouse.firstname %></a><br> 
                      &nbsp;<%= spouse.station%>
                      <% end %>
                    <% end %>
                  </div></div>
                  <br><br>
         <% else %>
        
                 <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                 <% if f_m_spouse.nil? or f_m_spouse.blank? %>
                       <div style="height:108px;">
                <div class="single-span1">
                        <% if family_member_user.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid" />
                        <% else %>
                          <%= image_tag family_member_user.photo.url(:small),:class => 'img-polaroid'   %>
                        <% end %>
                        <a href="/family_members/delete_member/<%= f.id %>" class="close"><img src="/assets/close.png"/></a><br>
                        &nbsp;<font size="3"><strong><%= f.relation.relationship %></strong></font><br>
                       <a href="/family_members/family/<%= family_member_user.id %>">
                        &nbsp;<%= family_member_user.firstname %></a> 
                        <br/> 
                        &nbsp;<%= family_member_user.station %>
                </div><br></div>
                <% end %>
         <% end %>
      <% end %>
    </td>
  <% end %>
  </tr>
</table>
<br></br>



<table class="bordered">
  <tr><th colspan=10><font color="#6B8E23"><h1>Second Generation</h1></font></th></tr>
  <tr>
    <% @user.relations.group("relationship").having("priority = ?", 2).order('id').each do |r| %>
    <td>
      <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
         <% family_member_user = User.find(f.family_member_user_id) %>
           
         <% if family_member_user.gender == "Male" %>
            <div class="span3"> 
              <div class="span1">
                      <% if family_member_user.photo_file_name.nil? %>
                        <img src="/assets/empty_profile.jpeg" class="img-polaroid" alt="" style="" />
                      <% else %>
                        <%= image_tag family_member_user.photo.url(:small), :class => 'img-polaroid'%>
                      <% end %>
                    <a href="/family_members/delete_member/<%= f.id %>" class="close">
                      <img src="/assets/close.png"/></a><br>
                      &nbsp;<font size="3"><strong><%= f.relation.relationship %></strong></font><br>
                      <a href="/family_members/family/<%= family_member_user.id %>">
                      &nbsp;<%= family_member_user.firstname %></a> <br>
                      &nbsp;<%= family_member_user.station%>
              </div>     
              <div class="spouse-span1">
                  <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                    <% unless f_m_spouse.nil? or f_m_spouse.blank? %>
                      <% spouse = User.find(f_m_spouse.family_member_user_id) %>
                      <% relation_with_spouse = FamilyMember.find_by_user_id_and_family_member_user_id(current_user.id,spouse.id) %>
                    
                       <% unless relation_with_spouse.nil? %> 
                        <% if spouse.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid"/>
                        <% else %>
                          <%= image_tag spouse.photo.url(:small) ,:class => 'img-polaroid' %>
                        <% end %>
                        <a href="/family_members/delete_member/<%= relation_with_spouse.id %>" class="close">
                         <img src="/assets/close.png"/></a><br>
                         &nbsp;<font size="3"><strong><%= relation_with_spouse.relation.relationship %></strong></font> <br>              
                      <a href="/family_members/family/<%= spouse.id %>">
                        &nbsp;<%= spouse.firstname %></a><br> 
                      &nbsp;<%= spouse.station%>
                      <% end %>
                    <% end %>
                  </div></div>
                  <br><br>
         <% else %>
        
                 <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                 <% if f_m_spouse.nil? or f_m_spouse.blank? %>
                      <div style="height:108px;">
                      <div class="single-span1">
                        <% if family_member_user.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid" />
                        <% else %>
                          <%= image_tag family_member_user.photo.url(:small),:class => 'img-polaroid'   %>
                        <% end %>
                        <a href="/family_members/delete_member/<%= f.id %>" class="close"><img src="/assets/close.png"/></a><br>
                        &nbsp;<font size="3"><strong><%= f.relation.relationship %></strong></font><br>
                       <a href="/family_members/family/<%= family_member_user.id %>">
                        &nbsp;<%= family_member_user.firstname %></a> 
                        <br/> 
                        &nbsp;<%= family_member_user.station %>
                      </div><br></div>  
                <% end %>
         <% end %>
      <% end %>
    </td>
  <% end %>
  </tr>
</table>
<br></br>




<table class="bordered">
  <tr><th colspan=10><font color="#9932CC"><h1>Third Generation</h1></font></th></tr>
  <tr>
    <% @user.relations.group("relationship").having("priority = ?", 3).order('id').each do |r| %>
    <td>
      <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
         <% family_member_user = User.find(f.family_member_user_id) %>
           
         <% if family_member_user.gender == "Male" %>
            <div class="span3"> 
              <div class="span1">

                        <% if family_member_user.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" class="img-polaroid"/>
                        <% else %>
                          <%= image_tag family_member_user.photo.url(:small) , :class => 'img-polaroid'%>
                        <% end %>
                        <% unless f.relation.relationship == "Me" %>
                          <a href="/family_members/delete_member/<%= f.id %>" class="close"><img src="/assets/close.png"/></a>
                        <% else %>
                        <br/>
                        <% end %>
                         &nbsp;<font size="3"><strong><%= f.relation.relationship %>
                        </strong></font><br>                         
                         <a href="/family_members/family/<%= family_member_user.id %>">
                      &nbsp;<%= family_member_user.firstname %></a> <br>
                      &nbsp;<%= family_member_user.station%>
                        <br/>
              </div>     

              <div class="spouse-span1">
                  <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                    <% unless f_m_spouse.nil? or f_m_spouse.blank? %>
                      <% spouse = User.find(f_m_spouse.family_member_user_id) %>
                      <% relation_with_spouse = FamilyMember.find_by_user_id_and_family_member_user_id(current_user.id,spouse.id) %>                    
                       <% unless relation_with_spouse.nil? %> 
                        <% if spouse.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid"/>
                        <% else %>
                          <%= image_tag spouse.photo.url(:small) ,:class => 'img-polaroid' %>
                        <% end %>
                        <% unless relation_with_spouse.relation.relationship == "Me" %>
                          <a href="/family_members/delete_member/<%= relation_with_spouse.id %>" class="close"><img src="/assets/close.png"/></a>
                        <% else %>
                        <br/>
                        <% end %>
                         &nbsp;<font size="3"><strong><%= relation_with_spouse.relation.relationship %></strong></font> <br>              
                      <a href="/family_members/family/<%= spouse.id %>">
                        &nbsp;<%= spouse.firstname %></a><br> 
                      &nbsp;<%= spouse.station%>
                      <% end %>
                    <% end %>
                  </div></div>
                  <br><br>
         <% else %>
        
                 <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                 <% if f_m_spouse.nil? or f_m_spouse.blank? %>
                <div style="height:108px;">
                  <div class="single-span1">              
                        <% if family_member_user.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid" />
                        <% else %>
                          <%= image_tag family_member_user.photo.url(:small),:class => 'img-polaroid'   %>
                        <% end %>
                        <% unless f.relation.relationship == "Me" %>
                          <a href="/family_members/delete_member/<%= f.id %>" class="close"><img src="/assets/close.png"/></a>
                        <% else %>
                        <br/>
                        <% end %>
                        &nbsp;<font size="3"><strong><%= f.relation.relationship %></strong></font><br>
                       <a href="/family_members/family/<%= family_member_user.id %>">
                        &nbsp;<%= family_member_user.firstname %></a> 
                        <br/> 
                        &nbsp;<%= family_member_user.station %>
                </div><br></div>
                <% end %>
         <% end %>
      <% end %>
    </td>
  <% end %>
  </tr>
</table>
<br></br>




<table class="bordered">
  <tr><th colspan=10><font color="#2F4F4F"><h1>Fourth Generation</h1></font></th></tr>
  <tr>
    <% @user.relations.group("relationship").having("priority = ?", 4).order('id').each do |r| %>
    <td>
      <% r.family_members.where('user_id = ? and join_pending = ?',@user.id,false).each do |f| %>
         <% family_member_user = User.find(f.family_member_user_id) %>
           
         <% if family_member_user.gender == "Male" %>
            <div class="span3"> 
              <div class="span1">
                      <% if family_member_user.photo_file_name.nil? %>
                        <img src="/assets/empty_profile.jpeg" class="img-polaroid" alt="" style="" />
                      <% else %>
                        <%= image_tag family_member_user.photo.url(:small), :class => 'img-polaroid'%>
                      <% end %>
                    <a href="/family_members/delete_member/<%= f.id %>" class="close">
                      <img src="/assets/close.png"/></a><br>
                      &nbsp;<font size="3"><strong><%= f.relation.relationship %></strong></font><br>
                      <a href="/family_members/family/<%= family_member_user.id %>">
                      &nbsp;<%= family_member_user.firstname %></a> <br>
                      &nbsp;<%= family_member_user.station%>
              </div>     
              <div class="spouse-span1">
                  <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                    <% unless f_m_spouse.nil? or f_m_spouse.blank? %>
                      <% spouse = User.find(f_m_spouse.family_member_user_id) %>
                      <% relation_with_spouse = FamilyMember.find_by_user_id_and_family_member_user_id(current_user.id,spouse.id) %>
                    
                       <% unless relation_with_spouse.nil? %> 
                        <% if spouse.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid"/>
                        <% else %>
                          <%= image_tag spouse.photo.url(:small) ,:class => 'img-polaroid' %>
                        <% end %>
                        <a href="/family_members/delete_member/<%= relation_with_spouse.id %>" class="close">
                         <img src="/assets/close.png"/></a><br>
                         &nbsp;<font size="3"><strong><%= relation_with_spouse.relation.relationship %></strong></font> <br>              
                      <a href="/family_members/family/<%= spouse.id %>">
                        &nbsp;<%= spouse.firstname %></a><br> 
                      &nbsp;<%= spouse.station%>
                      <% end %>
                    <% end %>
                  </div></div>
                  <br><br>
         <% else %>
         
                 <% f_m_spouse = FamilyMember.find_by_user_id_and_spouse_status(family_member_user.id,true) %>
                 <% if f_m_spouse.nil? or f_m_spouse.blank? %>
         <div style="height:108px;">
                <div class="single-span1">             
                        <% if family_member_user.photo_file_name.nil? %>
                          <img src="/assets/empty_profile.jpeg" alt="" class="img-polaroid" />
                        <% else %>
                          <%= image_tag family_member_user.photo.url(:small),:class => 'img-polaroid'   %>
                        <% end %>
                        <a href="/family_members/delete_member/<%= f.id %>" class="close"><img src="/assets/close.png"/></a><br>
                        &nbsp;<font size="3"><strong><%= f.relation.relationship %></strong></font><br>
                       <a href="/family_members/family/<%= family_member_user.id %>">
                        &nbsp;<%= family_member_user.firstname %></a> 
                        <br/> 
                        &nbsp;<%= family_member_user.station %>
                </div><br></div>
                <% end %>
         <% end %>
      <% end %>
    </td>
  <% end %>
  </tr>
</table>
<br></br>


<style type="text/css">
.span3{width:220px;height:108px;margin-left:0px;margin-top:2px;
}
.span1{background:lightblue;
                width:100px;margin-left:5px;border-radius:10px 0px;}
.bordered {
    border: 1px solid #CCCCCC;
    border-radius: 10px 10px 10px 10px;
    -moz-border-radius: 10px 10px 10px 10px;
    -webkit-border-radius: 10px 10px 10px 10px;
    box-shadow: 0 1px 1px #CCCCCC;
}
.img-polaroid{height:40px;width:60px;border-radius:10px}
.spouse-span1{background:lightpink;border-radius:10px 0px;
                  width:100px;margin-left:10px;}
.close{margin-top:0px;position:absolute;padding-left:10px;}
.single-span1{background:lightgreen;
                      border-radius:10px 0px;width:100px;margin-left:5px;margin-right:5px;}
table {
    border-spacing: 0;
    margin: 30px;
} 
.bordered th {
    background-color: #DCE9F9;
    background-image: -moz-linear-gradient(center top , #F8F8F8, #ECECEC);
    background-image: -webkit-gradient(linear, 0 0, 0 bottom, from(#F8F8F8), to(#ECECEC), color-stop(.4, #F8F8F8));
    border-top: medium none;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8) inset;
    text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
}

.bordered th {
    border-left: 1px solid #CCCCCC;
    border-top: 1px solid #CCCCCC;
    border-bottom: 2px solid #CCCCCC;
    padding: 10px;
    text-align: left;
}
.font{font-size: 16px;position: relative;padding: 4px;}


</style>
